<!DOCTYPE html>
<html>
    <head>
        {include file='pub/page'}
        <meta charset="UTF-8">
        <title>我的订单</title>
        <link rel="stylesheet" type="text/css" href="__STATIC__/home/css/tpshop.css"/>
        <link rel="stylesheet" type="text/css" href="__STATIC__/home/css/myaccount.css"/>
        <link rel="stylesheet" type="text/css" href="__STATIC__/home/css/location.css"/>
        <link rel="stylesheet" type="text/css" href="__STATIC__/home/css/base.css"/>
        <link rel="shortcut icon" type="image/x-icon" href="__STATIC__/home/images/logo/storeico_default.png" media="screen" />
        
        <script src="__STATIC__/home/js/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="__STATIC__/home/js/layer/layer.js" type="text/javascript"></script>
        <script src="__STATIC__/home/js/layer/laydate/laydate.js" type="text/javascript" ></script>
        <script src="__STATIC__/home/js/global.js" type="text/javascript"></script>
        <style>.list1 li{float:left;} .navitems2 li .selected {color: #e23435;border-bottom-color: #e23435;}</style>
    </head>
    <body class="bg-f5">
        <div class="tpshop-tm-hander home-index-top p">
            <div class="top-hander clearfix">
                <div class="w1224 pr clearfix">
                    
                    <ul class="top-ri-header fr clearfix">
                        <li><a target="_blank" href="/index.php/home/Order/order_list.html">我的订单</a></li>
                        <li class="spacer"></li>
                        <li class="spacer"></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="nav-middan-z p home-index-head">
            <div class="header w1224">
                <div class="ecsc-logo">
                    <a href="/" class="logo">
                        <img src="__STATIC__/home/upload/logo/2017/11-07/ac0351f4284b701cb9afe48726834a46.png" style="width: 159px;height: 58px">
                    </a>
                </div>
                <div class="m-index">
                    <a href="/index.php/home/User/index.html" class="index">我的商城</a>
                    <a href="/" class="home">返回商城首页</a>
                </div>
                <div class="m-navitems">
                    <ul class="fixed p">
                        <li><a href="/index.php/home/Index/index.html">首页</a></li>
                        <li>
                            <div class="u-dl">
                                <div class="u-dt">
                                    <span>账户设置</span><i></i>
                                </div>
                                <div class="u-dd">
                                    <a href="{:url('User/UserInfo')}">个人信息</a>
                                    <!--<a href="/index.php/home/User/safety_settings.html">安全设置</a>-->
                                    <a href="{:url('User/AddrEdit')}">收货地址</a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="u-g-cart fr" id="hd-my-cart">
                    <a href="{:url('Cart/cart1')}">
                        <div class="c-n fl">
                            <i class="share-shopcar-index"></i>
                            <span>我的购物车</span>
                           
                        </div>
                    </a>
                   
                </div>
            </div>
        </div>
        <script src="__STATIC__/home/js/common.js"></script>
        <div class="home-index-middle">
            <div class="w1224">
                <div class="g-crumbs">
                    <a href="/index.php/home/User/index.html">我的商城</a>
                    <i class="litt-xyb"></i>
                    <span>我的订单</span>
                </div>
                <div class="home-main">
                   <!--引入左侧菜单-->
                     {include file="pub/left"}
                    <div class="ri-menu fr">
                        <div class="menumain p">
                            <div class="navitems2 p" id="navitems5">
                                <ul>
                                    <li><a href="{:url('User/userOrderList')}" class="selected">全部订单</a></li>
                                    <li><a href="{:url('User/userOrderList',['type'=>'PAY'])}" class="">待付款</a></li>
                                    <li><a href="{:url('User/userOrderList',['type'=>'SHIPPING'])}" class="">待发货</a></li>
                                    <li><a href="{:url('User/userOrderList',['type'=>'ORDER'])}" class="">待收货</a></li>
                                    <li><a href="{:url('User/userOrderList',['type'=>'COMMENT'])}" class="">待评论</a></li>
                                </ul>
                                <div class="wrap-line" style="width: 130px; left: 10px;">
                                    <span style="left:15px;"></span>
                                </div>
                            </div>
                            <div class="menu_search p">
                                <form id="search_order" action="{:url('User/userOrderList')}" method="get">
                                    <input class="sea_ol" type="text" name="search_key" id="search_key" value="{notempty name='condition.search_key'}{$condition.search_key}{/notempty}" placeholder="商品名称，订单编号" />
                                    <input class="sea_et" type="submit" value="查询" style="cursor: pointer;" />
                                    <!--  <span class="coice">
                                    更多筛选条件
                                    <i class="jt-x"></i></span>
                                    <div class="time-qjc">
                                    下单时间：<input id="start_time" name="start_time" value="" style="width:150px;padding:7px 10px;border:1px solid #ccc;outline: none;"/>
                                    <span>至</span>
                                    <input id="end_time" name="end_time" style="width:150px;padding:7px 10px;border:1px solid #ccc;outline: none;" />
                                    <div class="nearl-zj">
                                    <ul>
                                    <li><a onclick="time_for_one_month();">最近一个月</a></li>
                                    <li><a onclick="time_for_three_month();">最近三个月</a></li>
                                    <li><a onclick="time_for_one_year();">最近一年</a></li></ul>
                                    </div>
                                    <div class="mu-btn">
                                    <a onclick="check_search_order();" href="jsvascript:">查询</a></div>
                                    </div> -->
                                </form>
                            </div>
                            <div class="orderbook-list">
                                <div class="book-tit">
                                    <ul>
                                        <li class="sx1">商品信息</i></li>
                                        <li class="sx2">单价</li>
                                        <li class="sx3">数量</li>
                                        <li class="sx4">订单总金额</li>
                                        <li class="sx5 s5clic">订单状态<i class="jt-x"></i></li>
                                        <li class="sx6">操作</li>
                                    </ul>
                                </div>
                                <div class="hid-derei">
                                    <ul>
                                        <li><a href="{:url('User/userOrderList')}">全部订单</a></li>
                                        <li><a href="{:url('User/userOrderList',['type'=>'PAY'])}">待付款</a></li>
                                        <li><a href="{:url('User/userOrderList',['type'=>'SHIPPING'])}">待发货</a></li>
                                        <li><a href="{:url('User/userOrderList',['type'=>'ORDER'])}">待收货</a></li>
                                        <li><a href="{:url('User/userOrderList',['type'=>'COMMENT'])}">待评论</a></li>
                                        <li><a href="{:url('User/userOrderList',['type'=>'FINISH'])}">已完成</a></li>
                                        <li><a href="{:url('User/userOrderList',['type'=>'CANCEL'])}">已取消</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="order-alone-li lastset_cm">
                             {foreach $orders as $order}
                                <table width="100%" border="" cellspacing="" cellpadding="">
                                {foreach $order as $k=>$v}
                                    {if condition="$k lt 1"}
                                    <tr class="time_or">
                                        <td colspan="6">
                                            <div class="fl_ttmm">
                                                <span class="time-num">下单时间：<em class="num">{:date('Y-m-d H:i:s',$v['add_time'])}</em></span>
                                                <span class="time-num">订单编号：<em class="num">{$v.order_sn}</em></span>
                                                <div class="paysoon">
                                                    {if condition="$v['order_status'] neq 3"}
                                                    {if condition="$v['pay_status'] eq 0"}
                                                    <a class="ps_lj" href="{:url('Cart/cart4',['order_id'=>$v['order_id']])}" target="_blank">立即支付</a>
                                                    {/if}
                                                    {if condition="$v['order_status'] neq 4"}
                                                    <a class="consoorder" href="javascript:void(0);" onClick="cancel_order({$v.order_id})">取消订单</a>
                                                    {/if}
                                                    {/if}
                                                    <!--<div class="dele"></div>-->
                                                </div>
                                            </div>
                                            <div class="fr_ttmm"></div>
                                        </td>
                                    </tr>
                                    {/if}
                                    <tr class="conten_or">
                                        <td class="sx1">  
                                            <div class="shop-if-dif">
                                                <div class="shop-difimg">
                                                    <img src="{:explode(',',$v.img)[0]}" width="60" height="60" />
                                                </div>
                                                <div class="shop_name">
                                                    <a href="{:url('Product/productDetails',['good_id'=>$v['good_id']])}">{$v.good_name}
                                                         <p>{$v.spec_key_name}</p>
                                                     </a>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="sx2">
                                            <span>￥</span>
                                            <span>{$v.good_price}</span>
                                        </td>
                                        <td class="sx3">
                                            <span>x{$v.good_num}</span>
                                        </td>
                                        <td class="sx4" rowspan="1">
                                            {if condition="$k lt 1"}
                                            <div class="pric_rhz">
                                                <p class="d_pri">
                                                    <span>￥</span>
                                                    <span>{$v.order_amount}</span>
                                                </p>
                                                <p class="d_yzo">
                                                    <spna>含运费：</spna>
                                                    <span>0.00</span>
                                                </p>
                                                <p class="d_yzo">
                                                    <a href="javascript:void(0);"></a>
                                                </p>
                                            </div>
                                            {/if}
                                        </td>
                                        <td class="sx5" rowspan="1">
                                            {if condition="$k lt 1"}
                                            <div class="detail_or">
                                                <p class="d_yzo">
                                            {if condition="$v['order_status'] eq 3"}
                                                已取消
                                                {else/}
                                                {if condition="$v['pay_status'] eq 0"}
                                                待支付
                                                {else/}
                                                已支付
                                                {/if}
                                                </p>
                                                <p><a href="{:url('User/details',['order_id'=>$v['order_id']])}">查看详情</a></p>
                                            {/if}
                                            </div>
                                            {/if}
                                        </td>
                                        <td class="sx6" rowspan="1">
                                            {if condition="$k lt 1"}
                                            <div class="rbac">
                                            {if condition="$v['order_status'] eq 1"}
                                                <p class="">等待商家发货</p>
                                            {/if}
                                            {if condition="$v['order_status'] eq 2"}
                                                <p class=""> <a href="javascript:void(0);" onClick="order_confirm({$v.order_id})">确认收货</a></p>
                                            {/if}
                                            {/if}
                                            {if condition="$v['order_status'] eq 4"}
                                                {if condition="$v['is_comment'] eq 0"}
                                                <p class=""> <a href="javascript:userComment({$v.good_id},{$v.order_id})">去评论</a></p>
                                                {else/}
                                                <p class=""> 已评论 </p>
                                                {/if}
                                                <p class=""> <a href="{:url('home/Product/productDetails')}?good_id={$v.good_id}">再次购买</a></p>
                                            {/if}
                                            </div>
                                            
                                        </td>
                                    </tr>
                                    {/foreach}
                                </table>
                                {/foreach}
                                <script type="text/javascript">
                                    function userComment(good_id,order_id) {
                                         layer.open({
                                             type: 2,
                                             title: '发表评论',
                                             skin: 'layui-layer-rim', //加上边框
                                             area: ['490px', '386px'], //宽高
                                             content: "{:url('home/user/addComment')}?good_id="+good_id+"&order_id="+order_id
                                         });    
                                     }
                                </script>
                        <span style="margin-left: 800px">{$page}</span>
                            </div>
                        </div>
                        <div class="operating fixed" id="bottom">
                            <div class="fn_page clearfix">
                                <div class='dataTables_paginate paging_simple_numbers'>
                                    <ul class='pagination'></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--footer-s-->
        {include file="pub/foot"}
        <!--footer-e-->
        <script type="text/javascript">
            $(function() {
                $('.s5clic').click(function() {
                    $('.hid-derei').slideToggle(400);
                    $(this).animate({
                        opacity: "1"
                    },
                    200,
                    function() {
                        $(this).toggleClass('sxbb')
                    })
                })
            })
            //取消订单
            function cancel_order(id) {
                layer.confirm('确定取消订单?', {
                    btn: ['确定', '取消'] //按钮
                },function() {
                    $.ajax({
                        url: "{:url('User/orderCancel')}",
                        type: 'POST',
                        dataType: 'JSON',
                        data: {
                            id: id
                        },
                        success: function(data) {
                            if (data.status == 1) {
                                layer.alert(data.msg, {
                                    icon: 1
                                },
                                function() {
                                    location.href = '';
                                })
                            } else {
                                layer.alert(data.msg, {
                                    icon: 2
                                });
                            }
                        },
                        error: function() {
                            layer.alert('网络失败，请刷新页面后重试', {
                                icon: 2
                            });
                        }
                    });
                },function(index) {
                    layer.close(index);
                });
            }

            function jump() {
                var max_page = "";
                var jump_page = $('#jump_page').val();
                if (jump_page > 0 && jump_page <= max_page) {
                    location.href = "/index.php/home/Order/order_list" + "/p/" + $('#jump_page').val();
                } else {
                    layer.alert('请输入正确的页数', {
                        icon: 2
                    });
                }
            }
            //确定收货
            function order_confirm(order_id) {
                layer.confirm("你确定收到货了吗?", {
                    btn: ['确定', '取消']
                },function() {
                    $.ajax({
                        type: 'post',
                        url: "{:url('User/orderEdit')}?order_id=" + order_id,
                        dataType: 'json',
                        success: function(data) {
                            if (data.status == 1) {
                                layer.alert(data.msg, {
                                    icon: 1
                                },
                                function() {
                                     location.href = '';
                                });
                            } else {
                                layer.alert(data.msg, {
                                    icon: 2
                                });
                                verify();
                            }
                        },
                        error: function(XMLHttpRequest, textStatus, errorThrown) {
                            layer.alert('网络失败，请刷新页面后重试', {
                                icon: 2
                            });
                        }
                    })
                },function(index) {
                    layer.close(index);
                });
            }

            function refund_order(obj) {
                layer.open({
                    type: 2,
                    title: '<b>订单取消申请</b>',
                    skin: 'layui-layer-rim',
                    shadeClose: true,
                    shade: 0.5,
                    area: ['600px', '500px'],
                    content: $(obj).attr('data-url'),
                });
            }
        </script>
    </body>
</html>